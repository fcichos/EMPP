{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: Title\n",
        "engine: jupyter\n",
        "---"
      ],
      "id": "13ad8585"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "#| echo: false\n",
        "import pandas as pd\n",
        "\n",
        "# Data\n",
        "data = {\n",
        "    'x': [0.000000000000000000e+00, 1.111111111111111049e-01, 2.222222222222222099e-01, 3.333333333333333148e-01, 4.444444444444444198e-01, 5.555555555555555802e-01, 6.666666666666666297e-01, 7.777777777777776791e-01, 8.888888888888888395e-01, 1.000000000000000000e+00],\n",
        "    'y': [9.916839204057067425e-01, 1.183667840440161712e+00, 1.310862148961057017e+00, 1.193174867265999639e+00, 1.265354130824580148e+00, 1.234277634100806154e+00, 1.067204799568996387e+00, 7.113706894723520469e-01, 5.111625429539546905e-01, 1.360838209996238390e+00],\n",
        "    'error': [5.332818799198481979e-02, 5.339559646742838422e-02, 5.366783326382672248e-02, 5.435097493883071090e-02, 5.576995501488732354e-02, 5.832636573698059268e-02, 6.242706729257353759e-02, 6.840334070620925078e-02, 7.645872257082597656e-02, 4.666811165343753287e-01]\n",
        "}\n",
        "\n",
        "# Create DataFrame\n",
        "df = pd.DataFrame(data)\n",
        "ojs_define(data=df)\n",
        "# Display DataFrame\n",
        "#df"
      ],
      "id": "4dba297c",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "```{ojs}\n",
        "//| echo: false\n",
        "viewof aSlider = Inputs.range([-4, 0], { label: \"a\", step: 0.01, value: -1.7 });\n",
        "viewof bSlider = Inputs.range([-2, 2], { label: \"b\", step: 0.01, value: 1.3 });\n",
        "viewof cSlider = Inputs.range([-2, 2], { label: \"c\", step: 0.01, value: 1.0 });\n",
        "```\n",
        "\n",
        "```{ojs}\n",
        "//| echo: false\n",
        "filtered = transpose(data);\n",
        "// Create the plot\n",
        "\n",
        "xValues = Array.from({ length: 100 }, (_, i) => i / 100);\n",
        "parabolaData = xValues.map(x => ({ x, y: parabola(x, aSlider, bSlider, cSlider) }));\n",
        "\n",
        "\n",
        "parabola = (x, a, b, c) => a * x**2 + b * x + c\n",
        "\n",
        "calculateChiSquared = (data, a, b, c) => {\n",
        "  let chisq = 0\n",
        "  let x= data.map(d => d.x)\n",
        "  let y= data.map(d => d.y)\n",
        "  let err= data.map(d => d.error)\n",
        "  for (let i = 0; i < x.length; i++) {\n",
        "    let y_model = parabola(x[i], a, b, c)\n",
        "    chisq += ((y[i] - y_model) / err[i])**2\n",
        "  }\n",
        "  return chisq\n",
        "}\n",
        "\n",
        "chisq = calculateChiSquared(filtered, aSlider, bSlider, cSlider)\n",
        "\n",
        "Plot.plot({\n",
        "  marks: [\n",
        "    Plot.dot(filtered, { x: \"x\", y: \"y\" }),\n",
        "    Plot.ruleY(filtered, { x: \"x\", y1: d => d.y - d.error, y2: d => d.y + d.error }),\n",
        "    Plot.line(parabolaData, { x: \"x\", y: \"y\" }),\n",
        "    Plot.text([{ x: 0.8, y: 1.5, label: `χ²: ${chisq.toFixed(2)}` }], {\n",
        "          x: \"x\",\n",
        "          y: \"y\",\n",
        "          text: \"label\",\n",
        "          dy: -10, // Adjust vertical position if needed\n",
        "          fill: \"black\", // Set text color\n",
        "          fontSize: 16\n",
        "        }),\n",
        "    Plot.frame()\n",
        "  ],\n",
        "  x: {\n",
        "    label: \"X Axis\",\n",
        "    labelAnchor: \"center\",\n",
        "    labelOffset: 35,\n",
        "    grid: true,\n",
        "    tickFormat: \".2f\", // Format ticks to 2 decimal places\n",
        "    domain: [0, 1]\n",
        "  },\n",
        "  y: {\n",
        "    label: \"Y Axis\",\n",
        "    grid: true,\n",
        "    tickFormat: \".2f\", // Format ticks to 2 decimal places\n",
        "    labelAnchor: \"center\",  // Center the label on its axis\n",
        "    labelAngle: -90,\n",
        "    labelOffset: 60,\n",
        "    domain: [0, 2],\n",
        "  },\n",
        "  width: 400,\n",
        "  height: 400,\n",
        "  marginLeft: 100,\n",
        "  marginBottom: 40,\n",
        "  style: {\n",
        "    fontSize: \"14px\",          // This sets the base font size\n",
        "    \"axis.label\": {\n",
        "      fontSize: \"18px\",        // This sets the font size for axis labels\n",
        "      fontWeight: \"bold\"       // Optionally make it bold\n",
        "    },\n",
        "    \"axis.tick\": {\n",
        "      fontSize: \"14px\"         // This sets the font size for tick labels\n",
        "    }\n",
        "  },\n",
        "})\n",
        "```\n",
        "\n",
        "\n",
        "Hello\n",
        "Here's how you can do it:\n",
        "\n",
        "### Step 1: Create the DataFrame in Python\n",
        "\n",
        "\n",
        "```{pyodide}\n",
        "# Here is some data of the height measurements including untertainties\n",
        "#x_data,y_data,err=np.loadtxt('data.txt',unpack=True)\n",
        "x_data, y_data, err = np.loadtxt(io.StringIO(data_str), unpack=True)\n",
        "```"
      ],
      "id": "eeeb7f99"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "import numpy as np\n",
        "import io\n",
        "import matplotlib.pyplot as plt\n",
        "from scipy.optimize import curve_fit\n",
        "plt.rcParams.update({'font.size': 18})\n",
        "from ipywidgets import interact, interactive, fixed, interact_manual\n",
        "import ipywidgets as widgets\n",
        "\n",
        "# default values for plotting\n",
        "plt.rcParams.update({'font.size': 12,\n",
        "                     'lines.linewidth': 1,\n",
        "                     'lines.markersize': 10,\n",
        "                     'axes.labelsize': 11,\n",
        "                     'xtick.labelsize' : 10,\n",
        "                     'ytick.labelsize' : 10,\n",
        "                     'xtick.top' : True,\n",
        "                     'xtick.direction' : 'in',\n",
        "                     'ytick.right' : True,\n",
        "                     'ytick.direction' : 'in',})\n",
        "\n",
        "data_str= \"\"\"\n",
        "0.000000000000000000e+00 9.916839204057067425e-01 5.332818799198481979e-02\n",
        "1.111111111111111049e-01 1.183667840440161712e+00 5.339559646742838422e-02\n",
        "2.222222222222222099e-01 1.310862148961057017e+00 5.366783326382672248e-02\n",
        "3.333333333333333148e-01 1.193174867265999639e+00 5.435097493883071090e-02\n",
        "4.444444444444444198e-01 1.265354130824580148e+00 5.576995501488732354e-02\n",
        "5.555555555555555802e-01 1.234277634100806154e+00 5.832636573698059268e-02\n",
        "6.666666666666666297e-01 1.067204799568996387e+00 6.242706729257353759e-02\n",
        "7.777777777777776791e-01 7.113706894723520469e-01 6.840334070620925078e-02\n",
        "8.888888888888888395e-01 5.111625429539546905e-01 7.645872257082597656e-02\n",
        "1.000000000000000000e+00 1.360838209996238390e+00 4.666811165343753287e-01\n",
        "\"\"\"\n",
        "x_data, y_data, err = np.loadtxt(io.StringIO(data_str), unpack=True)\n",
        "\n",
        "def parabola(x,a,b,c):\n",
        "    return(a*x**2+b*x+c)\n",
        "\n",
        "def plot(a,b,c):\n",
        "    y=parabola(x,a,b,c)\n",
        "    plt.figure(figsize=(8,6))\n",
        "    chisq=(((y_data-parabola(x_data,a,b,c))/err)**2).sum()\n",
        "    plt.plot(x,y,label=r'$\\chi^2$={0:6.3f}'.format(chisq))\n",
        "    plt.errorbar(x_data,y_data,yerr=err,marker='o',fmt=\"none\",color='k')\n",
        "\n",
        "    plt.scatter(x_data,y_data,marker='o',color='k')\n",
        "    plt.legend()\n",
        "    plt.xlabel('x- position')\n",
        "    plt.ylabel('y- position')\n",
        "    plt.show()\n",
        "\n",
        "x=np.linspace(0,1,100)\n",
        "interact(plot,a=-1.7,b=1.3,c=1.0);"
      ],
      "id": "5fca72fa",
      "execution_count": null,
      "outputs": []
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/Users/fci/Library/Jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}